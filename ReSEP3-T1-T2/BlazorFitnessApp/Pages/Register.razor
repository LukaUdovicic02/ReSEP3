@page "/account/create"
@using System.ComponentModel.DataAnnotations
@using BlazorApp1.Data
@inject HttpClient HttpClient
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager



<h3>Create an Account</h3>

<div>
    <label for="username">Username:</label>
    <InputText id="username" @bind="username" />
    <ValidationMessage For="() => username" />
    
    <label for="password">Password:</label>
    <InputText id="password" type="password" @bind="password" />
    <ValidationMessage For="() => password" />

    <button @onclick="CreateAccount">Create Account</button>
</div>

@code {
    private string username;
   
    private string password;

    private void CreateAccount()
    {
        async Task CreateAccount()
        {
         // ths paragraph will perform client-side validation 

            var validationContext = new ValidationContext(this);
            var validationResults = new List<ValidationResult>();
            var isValid = Validator.TryValidateObject(this, validationContext, validationResults, true);

            if (isValid)
            {
    
                var request = new User
                {
                    Username = username,
                    Password = password
                };
                var response = await HttpClient.PostAsJsonAsync("/api/accounts/create", request);

                if (response.IsSuccessStatusCode)
                {

                    NavigationManager.NavigateTo("/login");
                }
                else
                {
                    var errorMessage = await response.Content.ReadAsStringAsync();
                }
            }
        }

    }
}
